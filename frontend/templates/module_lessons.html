{# frontend/templates/module_lessons.html #}
{% extends "layout.html" %}
{% block title %}{{ module['title'] }} â€” Pelajaran{% endblock %}
{% block content %}

<div class="container py-5">
    
    <div class="text-center mb-5">
        <h2 class="fw-bold text-warning">{{ module['title'] }}</h2>
        <p class="text-muted">{{ module['description'] }}</p>
    </div>

    <h4 class="mb-4 text-white">Daftar Pelajaran</h4>

    <div class="d-grid gap-3"> 
        {% for lesson in lessons %}
            {% set progress_score = lesson['score'] if lesson['score'] is not none else 0 %}
            {% set max_score = lesson['max_score'] if lesson['max_score'] is not none and lesson['max_score'] > 0 else 1 %}
            
            {% if lesson['max_score'] is not none and lesson['max_score'] > 0 %}
                {% set percentage = (progress_score * 100 / max_score) | round(0) %}
            {% else %}
                {% set percentage = 0 %}
            {% endif %}

            <a href="{{ url_for('main.lesson_detail', id=lesson['id']) }}" 
               class="custom-lesson-item d-flex justify-content-between align-items-center">
                
                <div class="flex-grow-1">
                    <h5 class="mb-0 fw-bold text-white">{{ loop.index }}. {{ lesson['title'] }}</h5>
                </div>

                <div class="d-flex align-items-center gap-3">
                    
                    <div class="progress custom-progress" style="width: 100px; height: 10px;">
                        <div class="progress-bar bg-primary" role="progressbar" 
                             style="width: {{ percentage }}%;" 
                             aria-valuenow="{{ percentage }}" aria-valuemin="0" aria-valuemax="100">
                        </div>
                    </div>

                    <span class="badge rounded-pill p-2 
                        {{ 'bg-success text-white' if lesson['completed'] == 1 else 'bg-secondary text-white' }}">
                        {{ 'Selesai' if lesson['completed'] == 1 else percentage ~ '%' }}
                    </span>
                    
                    <i class="bi bi-chevron-right text-muted fs-5"></i>
                </div>
            </a>
        {% endfor %}
    </div>

    <div class="text-center mt-5">
        <a href="{{ url_for('main.modules') }}" class="btn btn-outline-primary rounded-3">
            <i class="bi bi-arrow-left"></i> Kembali ke Modul Utama
        </a>
    </div>

</div>
{% endblock %}